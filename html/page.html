<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Home - zHekBot</title>
   <script src="https://kit.fontawesome.com/439a9315b4.js" crossorigin="anonymous"></script>
   <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/css/bootstrap.min.css" rel="stylesheet"
      integrity="sha384-4Q6Gf2aSP4eDXB8Miphtr37CMZZQ5oXLH2yaXMJ2w8e2ZtHTl7GptT4jmndRuHDT" crossorigin="anonymous">
   <link rel="stylesheet" href="../styles/standard.css">
</head>

<body>
   <header>
      <nav class="navbar navbar-expand-lg navbar-dark bg-success">
         <a href="/" class="navbar-brand ms-2">
            <img src="../images/Logo.png" class="rounded-circle" id="headerLogo" alt="zHekBot logo" width="50"
               height="50">
         </a>
         <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup"
            aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
         </button>
         <div class="collapse navbar-collapse mx-2" id="navbarNavAltMarkup">
            <div class="navbar-nav">
               <a href="/" class="nav-item nav-link active" aria-current="page">Home</a>
               <a href="/commands/#channel#" class="nav-item nav-link">Commands</a>
               <a href="/leaderboards/#channel#" class="nav-item nav-link">Leaderboards</a>
               <a href="/modules/#channel#" class="nav-item nav-link">Modules</a>
               <a href="/twovtwo/#channel#" class="nav-item nav-link">Two vs Two</a>
               <a href="/editors/#channel#" class="nav-item nav-link #disabled#">Editors</a>
               <a href="/permissions/#channel#" class="nav-item nav-link #disabled#">Permissions</a>
            </div>
            <button type="button" class="btn btn-success ms-auto me-2" id="twitch"><i
                  class="fa-brands fa-twitch"></i>Logout of Twitch</button>
         </div>
      </nav>
   </header>
   <main>
      <div class="container pt-3">
         <div id="liveAlertPlaceholder"></div>
         <h2 class="text-center">#pref_name#'s zHekBot</h2>
         <div class="form-switch form-switch-lg text-center">
            <input type="checkbox" class="form-check-input border-3" role="switch" id="enableBot">
            <label class="form-check-label" for="enableBot" id="enableLabel">Disabled</label>
         </div>
      </div>
      <div class="container pt-3 pt-md-5 pb-5">
         <div class="row">
            <div class="col-12">
               zHekBot started as a bot for tracking stats in Call of Duty Warzone. However, the API for
               Warzone is no longer public, so zHekBot has switched to be primarily a chatbot that provides a
               couple of games (with user statistics). The games are based around the loser being timed out, so it
               works best if "zHekLeR" is a mod in the channel.
            </div>
         </div>
         <div class="row py-4">
            <div class="col-12">
               Here is a brief explanation of each tab above.
            </div>

            <div class="col-3 col-md-2 fw-bold pt-2">
               Home
            </div>
            <div class="col-9 col-md-10 pt-2">
               This page.
            </div>

            <div class="col-3 col-md-2 fw-bold pt-2">
               Commands
            </div>
            <div class="col-9 col-md-10 pt-2">
               A list of the commands available for each module and a description of what they do.
            </div>

            <div class="col-3 col-md-2 fw-bold pt-2">
               Leaderboards
            </div>
            <div class="col-9 col-md-7 pt-2">
               The best (or worst) scores for each chat game in a channel. If you think of other statistics, let me
               know and I would be happy to implement them. You can also search for another user's leaderboard
               here.
            </div>
            <div class="col-0 col-md-2"></div>

            <div class="col-3 col-md-2 fw-bold pt-2">
               Modules
            </div>
            <div class="col-9 col-md-10 pt-2">
               Enable or disable the different games and modules.
            </div>

            <div class="col-3 col-md-2 fw-bold pt-2">
               Two vs Two
            </div>
            <div class="col-9 col-md-7 pt-2">
               A mechanism to keep track of scores in a two-vs-two Warzone tourney. This is not automatic; it is
               intended to make scorekeeping easier. So, you must have the streams open on your own screen, then
               you can + or - the scores and send them to chat.
            </div>
            <div class="col-0 col-md-2"></div>

            <div class="col-3 col-md-2 fw-bold pt-2">
               Editors
            </div>
            <div class="col-9 col-md-10  pt-2">
               Add or remove people that can adjust your module settings and use the two-vs-two scorekeeping
               module.
            </div>

            <div class="col-3 col-md-2 fw-bold pt-2">
               Permissions
            </div>
            <div class="col-9 col-md-10 pt-2">
               See whose channels you are an editor for and go to their pages.
            </div>
         </div>
         <div class="row">
            <div class="col-12">
               If you have any questions on the bot,
               recommendations, or issues, the easiest place to reach me is on <a
                  href="https://discord.com/users/364876603097874433">Discord</a> or <a
                  href="https://www.twitch.tv/zhekler">Twitch</a>. I have a <a href="https://x.com/zHekLeR_">Twitter (or
                  X)</a>, too, but I don't use it as much, so a reply
               there may take a bit longer.
            </div>
         </div>
      </div>
   </main>

   <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.6/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-j1CDi7MgGQ12Z7Qab0qlWQ/Qqz24Gc6BM0thvEMVjHnfYGF0rmFCozFSxQBxwHKO"
      crossorigin="anonymous"></script>
   <script>
      const twitchBtn = document.getElementById("twitch");
      if (twitchBtn) twitchBtn.addEventListener('click', () => { twitch(); });

      const btn = document.getElementById("enableBot"), btnLbl = document.getElementById("enableLabel");
      if (btn) btn.addEventListener('click', () => { enable(); });

      var enabled = false, btnLblClass = btnLbl.className;
      if (enabled) {
         btn.setAttribute("checked", "");
         btnLbl.innerHTML = "Enabled";
         btnLbl.className = btnLblClass + " text-success";
      } else {
         btnLbl.className = btnLblClass + " text-danger";
      }

      const alertPlaceholder = document.getElementById('liveAlertPlaceholder')
      const appendAlert = (message, type) => {
         const wrapper = document.createElement('div')
         wrapper.innerHTML = [
            `<div class="alert alert-${type} alert-dismissible" role="alert">`,
            `   <div>${message}</div>`,
            '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
            '</div>'
         ].join('')

         alertPlaceholder.append(wrapper)
      }

      async function enable() {
         enabled = !enabled;
         btn.setAttribute("disabled", "");
         setTimeout(function () { btn.removeAttribute("disabled"); }, 2000);

         await fetch('/enable/#channel#')
            .then(res => {
               if (res.status !== 200) {
                  if (enabled) {
                     btn.checked = false;
                  } else {
                     btn.checked = true;
                  }
                  btnLbl.innerHTML = enabled ? "Disabled" : "Enabled";
                  btnLbl.className = btnLblClass + (enabled ? " text-danger" : " text-success");
                  enabled = !enabled;

                  appendAlert('Fetch call in enable() has returned status code: ' + res.status, 'danger');
               } else {
                  btnLbl.innerHTML = enabled ? "Enabled" : "Disabled";
                  btnLbl.className = btnLblClass + (enabled ? " text-success" : " text-danger");
               }
            })
            .catch(err => {
               if (enabled) {
                  btn.checked = false;
               } else {
                  btn.checked = true;
               }
               btnLbl.innerHTML = enabled ? "Disabled" : "Enabled";
               btnLbl.className = btnLblClass + (enabled ? " text-danger" : " text-success");
               enabled = !enabled;

               appendAlert('Fetch call in enable() has failed due to: ' + err, 'danger');
            });
      }

      async function twitch() {
         await fetch(`/login`, {
            method: "GET",
         })
            .then(res => {
               if (res.status === 200) {
                  res.text().then(res => {
                     window.location.href = res;
                  });
               } else if (res.status === 201) {
                  window.location.href = "/";
               } else {
                  appendAlert('Fetch call in twitch() has returned status code: ' + res.status, 'danger');
               }
            })
            .catch(err => {
               appendAlert('Fetch call in twitch() has failed due to: ' + err, 'danger');
            });
      };
   </script>
</body>

</html>